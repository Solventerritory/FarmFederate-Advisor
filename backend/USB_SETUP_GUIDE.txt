â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘        ESP32 USB CONNECTION GUIDE (WiFi Not Needed!)           â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ¯ MUCH SIMPLER: Your ESP32 is connected via USB, so we'll read
   the sensor data directly through the serial port!

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“‹ STEP 1: CHECK USB DRIVERS
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Your ESP32 uses one of these USB chips:
  - CP2102/CP2104 â†’ Need CP210x driver
  - CH340/CH341 â†’ Need CH340 driver

To check:
1. Open Device Manager (Win + X â†’ Device Manager)
2. Look under "Ports (COM & LPT)" section
3. You should see something like:
   - "Silicon Labs CP210x USB to UART Bridge (COM7)"
   - "USB-SERIAL CH340 (COM8)"
   
If you see a yellow warning or "Unknown Device":
  â†’ Download driver from:
     - CP210x: https://www.silabs.com/developers/usb-to-uart-bridge-vcp-drivers
     - CH340: http://www.wch.cn/downloads/CH341SER_ZIP.html

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“‹ STEP 2: UPLOAD USB SERIAL SKETCH TO ESP32
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

1. Open Arduino IDE

2. Install required libraries:
   Sketch â†’ Include Library â†’ Manage Libraries
   Install: ArduinoJson, DHT sensor library

3. Open the sketch:
   File â†’ Open â†’ Navigate to:
   backend/hardware/esp32_sensor_node/esp32_usb_serial.ino
   
   â­ This is the NEW sketch for USB mode (no WiFi config needed!)

4. Select your board:
   Tools â†’ Board â†’ ESP32 â†’ ESP32 Dev Module (or your board)

5. Select the COM port:
   Tools â†’ Port â†’ Select the COM port you saw in Device Manager

6. Upload:
   Click Upload button (â†’)
   Wait for "Done uploading"

7. Open Serial Monitor:
   Tools â†’ Serial Monitor
   Set baud rate to: 115200
   
   You should see:
   â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
   â•‘  ESP32 Sensor Node - USB Serial Mode  â•‘
   â•‘  FarmFederate-Advisor                  â•‘
   â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   âœ“ Relay initialized (OFF)
   âœ“ Flow sensor initialized
   âœ“ DHT22 sensor initialized
   âœ“ Soil moisture sensor ready
   
   Ready! Sending sensor data via USB Serial...
   
   Then every 5 seconds you'll see JSON data like:
   DATA:{"client_id":"esp32_usb_01","temperature":28.5,...}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“‹ STEP 3: RUN USB SERIAL READER (ON YOUR PC)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

IMPORTANT: Close Arduino Serial Monitor first!
(Only one program can access the COM port at a time)

1. Open PowerShell/Terminal

2. Run:
   cd C:\Users\USER_HP\Desktop\FarmFederate\FarmFederate-Advisor\backend
   C:/Users/USER_HP/miniconda3/python.exe usb_serial_reader.py

3. The script will:
   âœ“ Auto-detect your ESP32 COM port
   âœ“ Read sensor data every 5 seconds
   âœ“ Publish to MQTT (so your frontend can see it!)
   âœ“ Save to JSON files

4. You'll see live data:
   â° 14:32:45
   ğŸ“ Device: esp32_usb_01
   ğŸŒ¡ï¸  Temperature: 28.5Â°C
   ğŸ’§ Humidity: 65.2%
   ğŸŒ± Soil Moisture: 42.3%
   ğŸŒŠ Flow Rate: 1.2 L/min â† YOUR FLOW METER!
   ğŸ“Š Total Flow: 15.4 L
   ğŸ”Œ Relay: OFF
   âœ“ Published to MQTT: farmfederate/sensors/esp32_usb_01

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ¯ WHAT'S RUNNING NOW:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âœ“ MQTT Broker (Mosquitto) - localhost:1883
âœ“ Backend Server - http://0.0.0.0:8000
âœ“ Flutter Frontend - Chrome (launching)

NEEDS TO START:
â†’ USB Serial Reader (replaces MQTT listener for USB mode)

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“Š DATA FLOW WITH USB:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ESP32 Sensors
    â†“ (USB Cable)
usb_serial_reader.py
    â†“ (Publishes to)
MQTT Broker
    â†“ (Backend reads)
Backend Server API
    â†“ (Frontend displays)
Flutter App in Chrome

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ”§ COMMANDS TO CONTROL RELAY VIA USB:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

You can send commands to ESP32 through the serial connection:
  - Type "ON" or "RELAY_ON" â†’ Turn on water valve
  - Type "OFF" or "RELAY_OFF" â†’ Turn off water valve
  - Type "STATUS" â†’ Get status
  - Type "RESET_FLOW" â†’ Reset flow meter counter

These work when usb_serial_reader.py is NOT running.
Open Arduino Serial Monitor and type the command.

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

â“ TROUBLESHOOTING:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Problem: ESP32 not showing in Device Manager
â†’ Try different USB cable (must be data cable, not charge-only)
â†’ Try different USB port
â†’ Install USB drivers (see Step 1)

Problem: "Port already in use" error
â†’ Close Arduino Serial Monitor
â†’ Close any other serial terminal programs

Problem: Data looks garbled
â†’ Check baud rate is 115200
â†’ Try reconnecting ESP32

Problem: Flow meter shows 0
â†’ Check flow sensor wiring (GPIO 18)
â†’ Make sure water is flowing through sensor
â†’ Test with "RESET_FLOW" command

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âœ¨ ADVANTAGES OF USB MODE:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âœ“ No WiFi configuration needed!
âœ“ No IP address to find
âœ“ More reliable connection
âœ“ Faster data transfer
âœ“ Easier debugging
âœ“ Works anywhere

Only downside: ESP32 must stay connected to your PC via USB
(For wireless mode, use esp32_complete_sensors.ino with WiFi)
